<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Windovert – Internal Scheduler</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">

    <!-- Bootstrap CSS (CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="app.css" type="text/css">
  </head>

  <body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-3 no-print">
      <div class="container-fluid">
        <span class="navbar-brand fw-bold">Windovert</span>
        <span class="navbar-text text-white-50">
          Internal Booking & Team Scheduler
        </span>

        <!-- Auth status (Supabase) -->
        <div class="ms-auto d-flex align-items-center gap-2" id="authBar">
          <small class="text-white-50" id="authUserLabel">Not signed in</small>
          <button class="btn btn-sm btn-outline-light d-none" id="btnSignOut" type="button">
            Sign out
          </button>
        </div>
      </div>
    </nav>

    <main class="container mb-5 no-print">
      <!-- Tabs -->
      <ul class="nav nav-tabs mb-3" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button
            class="nav-link active"
            id="schedule-tab"
            data-bs-toggle="tab"
            data-bs-target="#schedule-pane"
            type="button"
            role="tab"
            >
            Schedule
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button
            class="nav-link"
            id="people-tab"
            data-bs-toggle="tab"
            data-bs-target="#people-pane"
            type="button"
            role="tab"
            >
            People
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button
            class="nav-link"
            id="products-tab"
            data-bs-toggle="tab"
            data-bs-target="#products-pane"
            type="button"
            role="tab"
            >
            Products
            </button>
        </li>
        </ul>

      <div class="tab-content">
        <!-- Schedule tab -->
        <div
        class="tab-pane fade show active"
        id="schedule-pane"
        role="tabpanel"
        aria-labelledby="schedule-tab"
        >

        <!-- Sticky schedule toolbar (view toggle + nav) -->
        <div class="schedule-toolbar sticky-top bg-light pb-2">
        <!-- View toggle: Day / Week -->
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="btn-group btn-group-sm" role="group">
            <button
                type="button"
                class="btn btn-outline-secondary active"
                id="btnViewDay"
            >
                Day view
            </button>
            <button
                type="button"
                class="btn btn-outline-secondary"
                id="btnViewWeek"
            >
                Week view
            </button>
            </div>

            <div class="schedule-week-label" id="scheduleLabel"></div>

            <div class="schedule-legend text-muted d-none d-sm-block">
            <!-- (legend content as before) -->
            <span>
                <span class="legend-color booking-service-pro"></span>
                Measure / Quote
            </span>
            <span>
                <span class="legend-color booking-service-major"></span>
                Install
            </span>
            <span>
                <span class="legend-color booking-service-expert"></span>
                Service
            </span>
            <span>
                <span class="legend-color booking-service-min"></span>
                Other
            </span>
            </div>
        </div>

        <!-- Day/week navigation -->
        <div class="mb-2">
            <div class="btn-group btn-group-sm" role="group" aria-label="Day/week nav">
            <button
                type="button"
                class="btn btn-outline-secondary"
                id="btnPrevPeriod"
            >
                &laquo; Prev
            </button>
            <button
                type="button"
                class="btn btn-outline-secondary"
                id="btnTodayPeriod"
            >
                Today
            </button>
            <button
                type="button"
                class="btn btn-outline-secondary"
                id="btnNextPeriod"
            >
                Next &raquo;
            </button>
            </div>

            <button
                type="button"
                class="btn btn-outline-secondary btn-sm ms-auto"
                id="btnPrintDay">
                Print day
            </button>
        </div>
        
        <!-- Job search -->
        <div class="card mb-3">
          <div class="card-body py-2">
            <div class="row g-2 align-items-center">
              <div class="col-md-6">
                <input
                  type="search"
                  class="form-control form-control-sm"
                  id="jobSearchInput"
                  placeholder="Search jobs by customer name…"
                  autocomplete="off"
                />
              </div>
              <div class="col-auto">
                <button type="button" class="btn btn-sm btn-outline-secondary" id="jobSearchClear">
                  Clear
                </button>
              </div>
              <div class="col-12">
                <div class="small text-muted">
                  Results are sorted by closest date to today. Click a result to jump to that job.
                </div>
              </div>
            </div>

            <div id="jobSearchResults" class="mt-2"></div>
          </div>
        </div>

</div>


        <div class="card">
            <div class="card-body">
            <!-- We render into this container for BOTH day/week modes -->
            <div
                class="schedule-grid-container"
                id="scheduleGridContainer"
            >
                <div id="scheduleLoading" class="text-muted small">
                Loading schedule…
                </div>
            </div>
            </div>
        </div>

        <p class="text-muted small mt-2">
            Click an empty slot to create a booking. Click an existing booking to edit
            or move it. (Drag & resize to come back once we hook your DnD logic in.)
        </p>
    </div>

        <!-- People tab -->
        <div
        class="tab-pane fade"
        id="people-pane"
        role="tabpanel"
        aria-labelledby="people-tab"
        >
        <div class="row g-3">
            <div class="col-md-5">
            <div class="card">
                <div class="card-header">
                <span class="fw-semibold">Add / edit person</span>
                </div>
                <div class="card-body">
                <form id="people-form">
                    <input type="hidden" id="person-id" />

                    <div class="mb-3">
                    <label for="person-name" class="form-label">Name</label>
                    <input
                        id="person-name"
                        type="text"
                        class="form-control form-control-sm"
                        placeholder="e.g. John Smith"
                        required
                    />
                    </div>

                    <div class="mb-3">
                    <label for="person-role" class="form-label">Role</label>
                    <select
                        id="person-role"
                        class="form-select form-select-sm"
                        required
                    >
                        <option value="fitter">Fitter</option>
                        <option value="sales">Sales</option>
                        <option value="admin">Admin</option>
                        <option value="other">Other</option>
                    </select>
                    </div>

                    <div class="mb-3">
                    <label for="person-phone" class="form-label">
                        Cellphone (optional)
                    </label>
                    <input
                        id="person-phone"
                        type="tel"
                        class="form-control form-control-sm"
                        placeholder="e.g. 082 123 4567"
                    />
                    </div>

                    <div class="d-flex gap-2">
                    <button
                        type="submit"
                        class="btn btn-sm btn-success flex-fill"
                    >
                        Save
                    </button>
                    <button
                        type="button"
                        id="btn-person-reset"
                        class="btn btn-sm btn-outline-secondary flex-fill"
                    >
                        Clear
                    </button>
                    </div>
                </form>
                </div>
            </div>
            </div>

            <div class="col-md-7">
            <div class="card h-100">
                <div class="card-header">
                <span class="fw-semibold">People</span>
                <div class="small text-muted">
                    Click a row to edit; use the bin icon to delete.
                </div>
                </div>
                <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-sm mb-0" id="people-table">
                    <thead>
                        <tr>
                        <th>Name</th>
                        <th>Role</th>
                        <th>Cell</th>
                        <th style="width:1%;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- populated by JS -->
                    </tbody>
                    </table>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>

        <!-- Products tab -->
        <div
        class="tab-pane fade"
        id="products-pane"
        role="tabpanel"
        aria-labelledby="products-tab"
        >
        <div class="row g-3">
            <div class="col-md-5">
            <div class="card">
                <div class="card-header">
                <span class="fw-semibold">Add / edit product</span>
                </div>
                <div class="card-body">
                <form id="products-form">
                    <input type="hidden" id="product-id" />

                    <div class="mb-3">
                    <label for="product-name" class="form-label">Name</label>
                    <input
                        id="product-name"
                        type="text"
                        class="form-control form-control-sm"
                        placeholder="e.g. Blind"
                        required
                    />
                    </div>


                    <div class="mb-3">
                    <label for="product-subtype" class="form-label">Sub-product</label>
                    <input
                        id="product-subtype"
                        type="text"
                        class="form-control form-control-sm"
                        placeholder="e.g. Wood, Vinyl"
                    />
                    </div>

                    <div class="d-flex gap-2">
                    <button
                        type="submit"
                        class="btn btn-sm btn-success flex-fill"
                    >
                        Save
                    </button>
                    <button
                        type="button"
                        id="btn-product-reset"
                        class="btn btn-sm btn-outline-secondary flex-fill"
                    >
                        Clear
                    </button>
                    </div>
                </form>
                </div>
            </div>
            </div>

            <div class="col-md-7">
            <div class="card h-100">
                <div class="card-header">
                <span class="fw-semibold">Products</span>
                <div class="small text-muted">
                    Click a row to edit; use the bin icon to delete.
                </div>
                </div>
                <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-sm mb-0" id="products-table">
                    <thead>
                        <tr>
                        <th>Name</th>
                        <th>Sub-product</th>
                        <th style="width:1%;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- populated by JS -->
                    </tbody>
                    </table>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>
        </div>
      </div>
    </main>

    <!-- Booking Modal -->
    <div
        class="modal fade"
        id="bookingModal"
        tabindex="-1"
        aria-labelledby="bookingModalLabel"
        aria-hidden="true"
        >
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <form class="modal-content" id="booking-form">
            <div class="modal-header">
                <h5 class="modal-title" id="bookingModalLabel">New booking</h5>
                <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
                ></button>
            </div>

            <div class="modal-body">
                <input type="hidden" id="booking-id" />

                <!-- Top row: date + team + time + duration -->
                <div class="row g-2 mb-3">
                <div class="col-md-3">
                    <label for="booking-date" class="form-label">Date</label>
                    <input
                    type="date"
                    class="form-control form-control-sm"
                    id="booking-date"
                    required
                    />
                </div>
                <div class="col-md-3">
                    <label for="booking-team" class="form-label">Team slot</label>
                    <select
                    id="booking-team"
                    class="form-select form-select-sm"
                    required
                    ></select>
                </div>
                <div class="col-md-3">
                    <label for="booking-start" class="form-label">Start time</label>
                    <select
                    id="booking-start"
                    class="form-select form-select-sm"
                    required
                    ></select>
                </div>
                <div class="col-md-3">
                    <label for="booking-duration" class="form-label">Duration (hours)</label>
                    <input
                    type="number"
                    step="0.5"
                    min="0.5"
                    class="form-control form-control-sm"
                    id="booking-duration"
                    value="1.5"
                    required
                    />
                </div>
                </div>

                <!-- Customer + phone + job type -->
                <div class="row g-2 mb-3">
                <div class="col-md-6">
                    <label for="booking-customer" class="form-label">Customer name</label>
                    <input
                    type="text"
                    class="form-control form-control-sm"
                    id="booking-customer"
                    />
                </div>
                <div class="col-md-3">
                    <label for="booking-phone" class="form-label">Client cell</label>
                    <input
                    type="tel"
                    class="form-control form-control-sm"
                    id="booking-phone"
                    placeholder="e.g. 082 123 4567"
                    />
                </div>
                <div class="col-md-3">
                    <label for="booking-jobType" class="form-label">Job type</label>
                    <select
                    id="booking-jobType"
                    class="form-select form-select-sm"
                    >
                    <option value="measure">Measure / Quote</option>
                    <option value="install">Install</option>
                    <option value="service">Service</option>
                    <option value="other">Other</option>
                    <option value="transit">Transit / Travel</option>
                    </select>
                </div>
                </div>

                <div class="row g-2 mb-3">
                <div class="col-md-4">
                    <label for="booking-salesperson" class="form-label">Salesperson</label>
                    <select id="booking-salesperson" class="form-select form-select-sm"></select>
                    <div class="form-text">Optional</div>
                </div>
                </div>

                <!-- Address -->
                <div class="mb-3">
                <label for="booking-address" class="form-label">Address</label>
                <textarea
                    class="form-control form-control-sm"
                    id="booking-address"
                    rows="2"
                ></textarea>
                </div>

                <!-- Notes -->
                <div class="mb-3">
                <label for="booking-notes" class="form-label">Notes</label>
                <textarea
                    class="form-control form-control-sm"
                    id="booking-notes"
                    rows="2"
                ></textarea>
                </div>

                <!-- Order numbers -->
                <div class="mb-3">
                <label for="booking-orderNumbers" class="form-label">Order number(s)</label>
                <textarea
                    class="form-control form-control-sm"
                    id="booking-orderNumbers"
                    rows="2"
                    placeholder="One per line if multiple"
                ></textarea>
                </div>

                <!-- Products + crew -->
                <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">Products</label>
                    <div id="booking-products" class="booking-products"></div>
                    <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary mt-1"
                    id="booking-add-product"
                    >
                    + Add product
                    </button>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Crew for this job</label>
                    <div
                    id="booking-crew"
                    class="booking-crew-list border rounded p-2"
                    style="max-height: 220px; overflow-y: auto;"
                    ></div>
                    <div class="form-text">
                    Tick who is on this job. Manage people on the People tab.
                    </div>
                </div>
                </div>

                <div class="alert alert-warning d-none" id="booking-error"></div>
            </div>

            <div class="modal-footer">
                <button
                type="button"
                class="btn btn-outline-danger me-auto d-none"
                id="btn-delete-booking"
                >
                Delete
                </button>
                <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
                >
                Cancel
                </button>
                <button type="submit" class="btn btn-primary">Save booking</button>
            </div>
            </form>
        </div>
    </div>
      </div>
    </div>

    <!-- Login modal (Supabase Auth) -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Sign in</h5>
          </div>
          <div class="modal-body">
            <form id="loginForm">
              <div class="mb-3">
                <label class="form-label" for="loginEmail">Email</label>
                <input class="form-control" id="loginEmail" type="email" autocomplete="username" required />
              </div>
              <div class="mb-2">
                <label class="form-label" for="loginPassword">Password</label>
                <input class="form-control" id="loginPassword" type="password" autocomplete="current-password" required />
              </div>
              <div class="alert alert-warning d-none" id="loginError"></div>
              <button class="btn btn-primary w-100" type="submit" id="btnLoginSubmit">Sign in</button>
            </form>
            <div class="form-text mt-2">
              Use the email/password from Supabase Auth (Dashboard → Authentication → Users).
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Print-only area -->
    <div id="printArea" class="print-area"></div>

    <!-- Bootstrap JS (for modal & tabs) -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- Our app (ES module) -->
    <script type="module" src="./app.js"></script>
  </body>
</html>